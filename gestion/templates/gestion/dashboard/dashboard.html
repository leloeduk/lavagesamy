{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Lavage Samy Auto{% endblock %}

{% block page_title %}Dashboard{% endblock %}


{% block content %}

<div class="mb-4">
  <a href="{% url 'gestion:facture-list' %}" class="btn btn-primary me-2">Factures</a>
  <a href="{% url 'gestion:service-list' %}" class="btn btn-secondary me-2">Services</a>
  <a href="{% url 'gestion:utilisateur-list' %}" class="btn btn-info me-2">Utilisateurs</a>
  <a href="{% url 'gestion:stats-mensuelles' %}" class="btn btn-warning">Statistiques</a>
</div>
<div class="row g-4">
  <div class="col-md-6 col-xl-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="card-title text-muted">Factures totales</h6>
        <h3 class="fw-bold">{{ factures_count }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="card-title text-muted">Services disponibles</h6>
        <h3 class="fw-bold">{{ services_count }}</h3>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="card-title text-muted">Total encaissé</h6>
        <h3 class="fw-bold text-success">{{ total_encaisse|floatformat:0 }} FCFA</h3>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-xl-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="card-title text-muted">Factures en attente</h6>
        <h3 class="fw-bold text-warning">{{ pending_factures }}</h3>
      </div>
    </div>
  </div>
</div>

<h5 class="mt-5">Dernières factures</h5>
<div class="table-responsive">
  <table class="table table-hover mt-3">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Client</th>
        <th>Service</th>
        <th>Montant</th>
      </tr>
    </thead>
    <tbody>
      {% for facture in recent_factures %}
      <tr>
        <td>{{ facture.date_heure|date:"d/m/Y" }}</td>
        <td>{{ facture.laveur.get_full_name|default:facture.laveur.username }}</td>
        <td>{{ facture.service.nom }}</td>
        <td>{{ facture.montant_total|floatformat:0 }} FCFA</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center">Aucune facture récente</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-5">Répartition des factures par statut</h5>
<ul class="list-group list-group-horizontal">
  {% for status in facture_status_distribution %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{ status.statut|capfirst }}
    <span class="badge bg-primary rounded-pill">{{ status.count }}</span>
  </li>
  {% endfor %}
</ul>

<h5 class="mt-5">Répartition par mode de paiement</h5>
<ul class="list-group">
  {% for payment in payment_method_distribution %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    {{ payment.mode_paiement|capfirst }}
    <span class="badge bg-success rounded-pill">{{ payment.count }}</span>
    <span class="text-muted ms-3">{{ payment.total|floatformat:0 }} FCFA</span>
  </li>
  {% endfor %}
</ul>
{% endblock %}
